<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="hr_employee_hour_report_dashboard_view" model="ir.ui.view">
        <field name="name">Hours Overview</field>
        <field name="type">dashboard</field>
        <field name="model">hr.employee.hour.report</field>
        <field name="arch" type="xml">
            <dashboard>
                <group>
                    <group col="2">
                        <aggregate string="Overtime (+) or Undertime (-)"
                                   name="overtime_undertime_aggregate"
                                   field="hours_qty"
                                   group_operator="sum"
                                   value_label="hours"/>
                    </group>
                    <group col="3">
                        <widget name="pie_chart"
                                title="Activity Analysis"
                                attrs="{'groupby': 'analytic_group_id', 'domain':'[(\'type\', \'=\', \'timesheet\', \'leave\')]', 'measure': 'percentage'}"/>
                    </group>
                </group>

                <group string="Contract vs Timesheets" col="1">
                    <view type="pivot"
                          ref="hr_timesheet_overview.hr_employee_hour_report_pivot_view"/>
                </group>
            </dashboard>
        </field>
    </record>

    <record id="hr_employee_hour_report_pivot_view" model="ir.ui.view">
        <field name="name">hr.employee.hour.report.pivot</field>
        <field name="model">hr.employee.hour.report</field>
        <field name="arch" type="xml">
            <pivot string="Hours Report" stacked="True">
                <field name="date" type="row"/>
                <field name="type" type="col"/>
                <field name="hours_qty" type="measure"/>
                <field name="days_qty" type="measure"/>
                <field name="percentage" type="measure" invisible="1"/>
                <field name="hours_qty_abs" type="measure" invisible="1"/>
                <field name="days_qty_abs" type="measure" invisible="1"/>
            </pivot>
        </field>
    </record>

    <record id="hr_employee_hour_report_tree_view" model="ir.ui.view">
        <field name="name">hr.employee.hour.report.tree</field>
        <field name="model">hr.employee.hour.report</field>
        <field name="arch" type="xml">
            <tree string="Hours Report">
                <field name="date" />
                <field name="type" />
                <field name="leave_type" />
                <field name="employee_id" />
                <field name="manager_id" />
                <field name="user_id" />
                <field name="company_id" />
                <field name="project_id" />
                <field name="analytic_group_id" />
                <field name="days_qty" />
                <field name="hours_qty" />
            </tree>
        </field>
    </record>

    <record id="hr_employee_hour_report_graph_view" model="ir.ui.view">
        <field name="name">hr.employee.hour.report.graph</field>
        <field name="model">hr.employee.hour.report</field>
        <field name="arch" type="xml">
            <graph string="Activity Analysis" type="pie" stacked="True">
                <field name="analytic_group_id" type="col"/>
                <field name="percentage" type="measure"/>
                <field name="hours_qty" type="measure" invisible="1"/>
                <field name="days_qty" type="measure" invisible="1"/>
                <field name="hours_qty_abs" type="measure" invisible="1"/>
                <field name="days_qty_abs" type="measure" invisible="1"/>
            </graph>
        </field>
    </record>

    <record id="hr_employee_hour_report_search_view" model="ir.ui.view">
        <field name="name">hr.employee.hour.report.search</field>
        <field name="model">hr.employee.hour.report</field>
        <field name="arch" type="xml">
            <search string="Hours Report">
                <field name="employee_id"/>
                <field name="user_id"/>
                <field name="date"/>
                <field name="type"/>
                <field name="project_id"/>
                <field name="manager_id"/>
                <group expand="1" string="Group By">
                    <filter name="filter_my_report" domain="[('user_id', '=', uid)]"
                            string="My report"/>
                    <filter name="filter_my_team" domain="[('manager_id', '=', uid)]"
                            string="My team"/>
                    <separator/>
                    <filter name="filter_this_year" string="This Year"
                            domain="[('date', '&gt;=', context_today().strftime('%Y-01-01')), ('date', '&lt;=', context_today().strftime('%Y-12-31'))]"/>
                    <filter name="filter_until_today" string="Until today"
                            domain="[('date', '&lt;=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter name="filter_this_year_until_today" string="This Year Until Today"
                            domain="[('date', '&gt;=', context_today().strftime('%Y-01-01')), ('date', '&lt;=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter name="filter_employee" string="Employee"
                            context="{'group_by':'employee_id'}"/>
                    <filter name="filter_user" string="User"
                            context="{'group_by':'user_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_hr_employee_hour_report" model="ir.actions.act_window">
        <field name="name">Hours Report</field>
        <field name="res_model">hr.employee.hour.report</field>
        <field name="view_mode">dashboard,tree</field>
        <field name="search_view_id"
               ref="hr_employee_hour_report_search_view"/>
        <field name="context">{
            'search_default_filter_my_report': 1,
            'search_default_filter_this_year_until_today': 1,
            }
        </field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No data yet!
            </p>
        </field>
    </record>

    <menuitem id="menu_hr_employee_hour_report" name="Hours Report"
              groups="base.group_user"
              parent="menu_hr_report_dashboard" sequence="10"
              action="action_hr_employee_hour_report"/>

</odoo>
